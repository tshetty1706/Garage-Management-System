<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMS Admin Dashboard</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --bg-body: #121212;
            --bg-sidebar: #18181b;
            --bg-card: #1e1e1e;
            --bg-input: #27272a;
            --primary: #f97316; /* The Orange Color */
            --primary-hover: #ea580c;
            --text-main: #ffffff;
            --text-muted: #a1a1aa;
            --border-color: #2e2e2e;
            --status-pending: #fbbf24;
            --radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden; /* Prevent full page scroll, scroll content instead */
        }

        /* --- LAYOUT GRID --- */
        .app-container {
            display: grid;
            grid-template-columns: 260px 1fr; /* Sidebar Width | Content Width */
            height: 100vh;
        }

        /* --- SIDEBAR STYLES --- */
        .sidebar {
            background-color: var(--bg-sidebar);
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 40px;
            color: var(--text-main);
        }

        .logo i {
            color: var(--primary);
            font-size: 24px;
        }

        .nav-links {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: var(--radius);
            color: var(--text-muted);
            text-decoration: none;
            transition: all 0.3s;
            font-size: 15px;
        }

        .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-main);
        }

        .nav-item.active {
            background-color: var(--primary);
            color: white;
            font-weight: 500;
        }

        /* --- MAIN CONTENT AREA --- */
        .main-content {
            background-color: var(--bg-body);
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* Scrollable content */
        }

        /* Header */
        .top-bar {
            padding: 20px 30px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            border-bottom: 1px solid transparent;
        }


        .user-profile {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background-color: #3f3f46;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        /* Dashboard Padding */
        .dashboard-view {
            padding: 30px;
        }

        .page-title {
            font-size: 24px;
            margin-bottom: 25px;
            font-weight: 600;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--bg-card);
            padding: 20px;
            border-radius: var(--radius);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border: 1px solid var(--border-color);
        }

        .stat-info h3 {
            font-size: 14px;
            color: var(--text-muted);
            font-weight: 400;
            margin-bottom: 10px;
        }

        .stat-info p {
            font-size: 28px;
            font-weight: 600;
        }

        .icon-box {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background-color: rgba(249, 115, 22, 0.1);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        /* Split Section: Table & Quick Actions */
        .split-section {
            display: grid;
            grid-template-columns: 2.5fr 1fr;
            gap: 20px;
        }

        /* Table Section */
        .card-container {
            background-color: var(--bg-card);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .section-header {
            font-size: 16px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th {
            text-align: left;
            color: var(--text-muted);
            font-weight: 500;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        td {
            padding: 15px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: #e4e4e7;
        }

        .status-text {
            color: var(--status-pending);
            font-weight: 500;
        }

        /* Quick Actions Buttons */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .action-btn {
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-muted);
            padding: 12px;
            border-radius: var(--radius);
            cursor: pointer;
            text-align: center;
            transition: 0.2s;
            font-size: 14px;
        }

        .action-btn:hover {
            background-color: var(--bg-input);
            color: white;
            border-color: var(--text-muted);
        }

        #admin-head {
            border: 1px solid var(--border-color);
            border-radius: 14px;
            padding: 25px 30px;
            margin-bottom: 25px;
            background: linear-gradient(135deg, #1a1a1a, #111111);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        #admin-head h3 {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-muted);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        #adminName {
            font-size: 30px;
            font-weight: 600;
            color: var(--text-main);
            letter-spacing: 0.5px;
        }

        #adminUsername {
            font-size: 14px;
            font-weight: 500;
            color: var(--primary);
            background-color: rgba(249, 115, 22, 0.1);
            padding: 6px 12px;
            border-radius: 20px;
            width: fit-content;
        }

        .admin-label {
            font-size: 13px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .activity-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }

        .activity-controls select,
        .activity-controls input {
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            color: white;
            padding: 8px 12px;
            border-radius: var(--radius);
            outline: none;
        }

        .activity-controls button {
            background: var(--primary);
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius);
            color: white;
            cursor: pointer;
        }

        .activity-controls button:hover {
            background: var(--primary-hover);
        }

        /* --- SALES FORM STYLING --- */

.sales-form {
    display: flex;
    flex-direction: column;
    gap: 14px;
    max-width: 420px;
}

.sales-form label {
    font-size: 13px;
    color: var(--text-muted);
    margin-bottom: 4px;
}

.sales-form input {
    padding: 10px 12px;
    background: var(--bg-input);
    border: 1px solid var(--border-color);
    color: white;
    border-radius: var(--radius);
    outline: none;
    transition: 0.2s;
}

.sales-form input:focus {
    border-color: var(--primary);
}

/* Toggle group */
.toggle-group {
    display: flex;
    gap: 10px;
    position:relative;
}

.toggle-btn {
    padding: 8px 14px;
    background: var(--bg-input);
    border: 1px solid var(--border-color);
    color: var(--text-muted);
    border-radius: var(--radius);
    cursor: pointer;
    transition: 0.2s;
}

.toggle-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}


.toggle-group input[type="radio"] {
    position: absolute;
    opacity: 0;
}


.toggle-group input[type="radio"]:checked + label {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}


.sales-layout {
    display: grid;
    grid-template-columns: 400px 1fr;
    gap: 40px;
}


@media (max-width: 1200px) {
    .sales-layout {
        grid-template-columns: 1fr;
    }
}


    </style>
</head>
<body>

<div class="app-container">
    <nav class="sidebar">
        <div class="logo">
            <i class="fa-solid fa-screwdriver-wrench"></i>
            <span>GMS Admin</span>
        </div>

        <ul class="nav-links">

            <li class="nav-item" data-page="home" onclick="navigate('home')">
                <i class="fa-solid fa-house"></i>
                Home
            </li>

            <li class="nav-item" data-page="dashboard" onclick="navigate('dashboard')">
                <i class="fa-solid fa-table-columns"></i>
                Dashboard
            </li>

            <li class="nav-item" data-page="users" onclick="navigate('users')">
                <i class="fa-solid fa-users"></i>
                Users
            </li>

            <li class="nav-item" data-page="vehicles" onclick="navigate('vehicles')">
                <i class="fa-solid fa-car"></i>
                Vehicles
            </li>

            <li class="nav-item" data-page="services" onclick="navigate('services')">
                <i class="fa-solid fa-screwdriver-wrench"></i>
                Services
            </li>

            <li class="nav-item" data-page="settings" onclick="navigate('settings')">
                <i class="fa-solid fa-gear"></i>
                Settings
            </li>

            <li class="nav-item" onclick="logout()">
                <i class="fa-solid fa-right-from-bracket"></i>
                Logout
            </li>

        </ul>
        <!--            <li><a href="#" class="nav-item"><i class="fa-solid fa-file-lines"></i> Reports</a></li>-->
    </nav>

    <main class="main-content">
        <header class="top-bar">
            <div class="user-profile">
                <div class="user-avatar">
                    <i class="fa-solid fa-user"></i>
                </div>
                <i class="fa-solid fa-chevron-down" style="font-size: 12px; color: var(--text-muted);"></i>
            </div>
        </header>

        <div class="dashboard-view" id="contentArea">
            <div id="admin-head">
                <div class="admin-label">Admin</div>
                <div class="admin-info">
                    <h1 id="adminName"></h1>
                    <span id="adminUsername"></span>
                </div>
            </div>


            <h2 class="page-title">Dashboard</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-info">
                        <h3>Total Users</h3>
                        <p id="totalUsers">0</p>
                    </div>
                    <div class="icon-box">
                        <i class="fa-regular fa-user"></i>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-info">
                        <h3>Active Services</h3>
                        <p id="activeServices">0</p>
                    </div>
                    <div class="icon-box">
                        <i class="fa-solid fa-screwdriver-wrench"></i>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-info">
                        <h3>Total Revenue</h3>
                        <p id="totalRevenue">$0</p>
                    </div>
                    <div class="icon-box">
                        <i class="fa-solid fa-dollar-sign"></i>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-info">
                        <h3>Pending Requests</h3>
                        <p id="pendingRequests">None</p>
                    </div>
                    <div class="icon-box">
                        <i class="fa-regular fa-clock"></i>
                    </div>
                </div>
            </div>

            <div class="split-section">
                <div class="card-container">
                    <h3 class="section-header">Recent Activity</h3>
                    <table>
                        <thead>
                        <tr>
                            <th>Date</th>
                            <th>Booking Id</th>
                            <th>Action</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody id="recentActivityTable"></tbody>
                    </table>
                </div>

                <div class="card-container">
                    <h3 class="section-header">Quick Actions</h3>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="openAddUserModal()">
                            Add New User
                        </button>
                        <button class="action-btn" onclick="openAddAdminModal()">Add New Admin</button>
                    </div>
                </div>

            </div>
        </div>

    </main>
</div>
<!-- ADD USER MODAL -->
<div id="addUserModal" style="
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.7);
    justify-content:center;
    align-items:center;
    z-index:1000;
">

    <div style="
        background:#1e1e1e;
        padding:25px;
        width:400px;
        border-radius:10px;
        border:1px solid #2e2e2e;
    ">

        <h3 style="margin-bottom:15px;">Add New User</h3>

        <div id="addUserMessage"
             style="display:none;
            margin-bottom:12px;
            padding:10px;
            border-radius:6px;
            font-weight:500;">
        </div>


        <input id="newName" placeholder="Full Name" type="text" required
               style="width:100%;margin-bottom:10px;padding:10px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;">

        <input id="newUsername" placeholder="Username" type="text" required
               style="width:100%;margin-bottom:10px;padding:10px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;">

        <input id="newEmail" placeholder="Email" type="email" required pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"
               style="width:100%;margin-bottom:10px;padding:10px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;">

        <input id="newPhone" placeholder="Phone" type="number" required
               style="width:100%;margin-bottom:10px;padding:10px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;">

        <input id="newPassword" type="password" placeholder="Password" required
               style="width:100%;margin-bottom:15px;padding:10px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;">

        <div style="display:flex;justify-content:space-between;">
            <button onclick="closeAddUserModal()"
                    style="background:#3f3f46;border:none;padding:8px 16px;border-radius:6px;color:white;cursor:pointer;">
                Cancel
            </button>

            <button onclick="submitNewUser()"
                    style="background:#f97316;border:none;padding:8px 16px;border-radius:6px;color:white;cursor:pointer;">
                Add User
            </button>
        </div>

    </div>
</div>

<!-- ADD ADMIN MODAL -->
<div id="addAdminModal" style="
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.7);
    justify-content:center;
    align-items:center;
    z-index:1000;
">

    <div style="
        background:#1e1e1e;
        padding:25px;
        width:400px;
        border-radius:10px;
        border:1px solid #2e2e2e;
    ">

        <h3 style="margin-bottom:15px;">Add New Admin</h3>

        <div id="addAdminMessage"
             style="display:none;margin-bottom:12px;padding:10px;border-radius:6px;font-weight:500;">
        </div>

        <input id="adminNameInput" placeholder="Full Name" type="text" required
               style="width:100%;margin-bottom:10px;padding:10px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;">

        <input id="adminUsernameInput" placeholder="Username" type="text" required
               style="width:100%;margin-bottom:10px;padding:10px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;">

        <input id="adminEmailInput" placeholder="Email" type="email" required
               style="width:100%;margin-bottom:10px;padding:10px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;">

        <input id="adminPhoneInput" placeholder="Phone" type="number" required
               style="width:100%;margin-bottom:10px;padding:10px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;">

        <input id="adminPasswordInput" type="password" placeholder="Password" required
               style="width:100%;margin-bottom:15px;padding:10px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;">

        <div style="display:flex;justify-content:space-between;">
            <button onclick="closeAddAdminModal()"
                    style="background:#3f3f46;border:none;padding:8px 16px;border-radius:6px;color:white;cursor:pointer;">
                Cancel
            </button>

            <button onclick="submitNewAdmin()"
                    style="background:#f97316;border:none;padding:8px 16px;border-radius:6px;color:white;cursor:pointer;">
                Add Admin
            </button>
        </div>
    </div>
</div>

<script>
    if (!localStorage.getItem("userId")) {
    window.location.href = "login.html";
}
    let adminData = [];
    let currentAdminPage = 1;
    let activityData = [];
    let currentActivityPage = 1;
    let usersData = [];
    let vehiclesData = [];
    let servicesData = [];

    const pageSize = 5;
    let currentUserPage = 1;
    let currentVehiclePage = 1;
    let currentServicePage = 1;
    let editingSaleId = null;

    const API_URL = "http://localhost:8081";
    const adminId = localStorage.getItem("userId");

    function loadDashboard() {

    document.getElementById("contentArea").innerHTML = `

        <div id="admin-head">
            <div class="admin-label">Admin</div>
            <div class="admin-info">
                <h1 id="adminName"></h1>
                <span id="adminUsername"></span>
            </div>
        </div>

        <h2 class="page-title">Dashboard</h2>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-info">
                    <h3>Total Users</h3>
                    <p id="totalUsers">0</p>
                </div>
                <div class="icon-box">
                    <i class="fa-regular fa-user"></i>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-info">
                    <h3>Active Services</h3>
                    <p id="activeServices">0</p>
                </div>
                <div class="icon-box">
                    <i class="fa-solid fa-screwdriver-wrench"></i>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-info">
                    <h3>Total Revenue</h3>
                    <p id="totalRevenue">₹0</p>
                </div>
                <div class="icon-box">
                    <i class="fa-solid fa-dollar-sign"></i>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-info">
                    <h3>Pending Requests</h3>
                    <p id="pendingRequests">None</p>
                </div>
                <div class="icon-box">
                    <i class="fa-regular fa-clock"></i>
                </div>
            </div>
        </div>

        <div class="split-section">

            <div class="card-container">
                <h3 class="section-header">Recent Activity</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Booking Id</th>
                            <th>Action</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="recentActivityTable"></tbody>
                </table>
            </div>

            <div class="card-container">
                <h3 class="section-header">Quick Actions</h3>
                <div class="action-buttons">
                    <button class="action-btn" onclick="openAddUserModal()">
                        Add New User
                    </button>
                    <button class="action-btn" onclick="openAddAdminModal()">
                        Add New Admin
                    </button>

                </div>
            </div>

        </div>
    `;

    // Fetch dashboard data
    fetch(`${API_URL}/api/admin/dashboard/${adminId}`)
        .then(res => res.json())
        .then(data => {

            document.getElementById("adminName").innerText = data.name;
            document.getElementById("adminUsername").innerText = "@" + data.userName;

            document.getElementById("totalUsers").innerText = data.totalUsers;
            document.getElementById("activeServices").innerText = data.activeServices;
            document.getElementById("pendingRequests").innerText =
                data.pendingRequests === 0 ? "None" : data.pendingRequests;

            document.getElementById("totalRevenue").innerText =
                "₹" + (data.totalRevenue || 0);

            const table = document.getElementById("recentActivityTable");
            table.innerHTML = "";

            if (!data.recentActivity || data.recentActivity.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align:center;color:#a1a1aa">
                            No recent activity
                        </td>
                    </tr>`;
            } else {
                data.recentActivity.forEach(item => {
                    table.innerHTML += `
                        <tr>
                            <td>${item.date}</td>
                            <td>VGMS${item.bookingId}</td>
                            <td>Service Booking</td>
                            <td class="status-text">${item.status}</td>
                        </tr>
                    `;
                });
            }

        })
        .catch(err => console.error("Dashboard error:", err));
}
    function loadUsers() {

        document.getElementById("contentArea").innerHTML = `

            <h2 class="page-title">Users</h2>
            <div id="userMessage"
                         style="margin-bottom:15px; display:none; padding:10px 15px;
                                border-radius:6px; font-weight:500;">
            </div>
            <div class="card-container">

                <div class="activity-controls">

                <!-- SORT -->
                <select id="userSort" onchange="fetchUsers()">
                    <option value="ASC">Name ASC</option>
                    <option value="DESC">Name DESC</option>
                </select>

                <!-- SEARCH INPUT -->
                <div style="position:relative;">
                    <input type="text" id="userSearch"
                           placeholder="Search by username"
                           onkeyup="fetchUsers()"
                           style="padding-left:35px;">

                    <i class="fa-solid fa-magnifying-glass"
                       style="position:absolute; left:10px; top:9px; color:#a1a1aa;">
                    </i>
                </div>

            </div>


                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Full Name</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTable"></tbody>
                </table>
                <div id="usersPagination" style="margin-top:20px;text-align:center;"></div>
            </div>
        `;

        fetchUsers();
    }

    function fetchUsers() {

    const sort = document.getElementById("userSort").value;
    const search = document.getElementById("userSearch").value;

    fetch(`${API_URL}/api/admin/users?sort=${sort}&search=${search}`)
        .then(res => res.json())
        .then(data => {

            usersData = data;
            currentUserPage = 1;
            renderUsersTable();
            renderPagination(usersData, currentUserPage, "usersPagination", "changeUserPage");

        })
        .catch(err => console.error("User fetch error:", err));
}

    function deleteUser(id, canDelete) {

    if (!canDelete) {
        showMessage("userMessage",
        "Cannot delete user with active or pending services",
        "error"
    );
        return;
    }

    fetch(`${API_URL}/api/admin/user/${id}?adminId=${adminId}`, {
        method: "DELETE"
    })
    .then(res => res.text())
    .then(message => {
        showMessage("userMessage",message, "success");
        fetchUsers();


    })
    .catch(err => {
        showMessage("userMessage","Error deleting user", "error");
    });
}

    function viewUser(id) {

    fetch(`${API_URL}/api/admin/user/${id}/vehicles`)
        .then(res => res.json())
        .then(data => {

            let vehiclesHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2 class="page-title">User Vehicles</h2>

                    <!-- BACK BUTTON -->
                    <button onclick="loadUsers()"
                        style="background:var(--primary);
                               border:none;
                               color:white;
                               padding:8px 14px;
                               border-radius:6px;
                               cursor:pointer;">
                        <i class="fa-solid fa-arrow-left"></i>
                        Back to Users
                    </button>
                </div>
                <div class="card-container">
                <table>
                    <thead>
                        <tr>
                            <th>Vehicle No</th>
                            <th>Model</th>
                            <th>Type</th>
                            <th>Fuel Type</th>
                            <th>Manufacture Year</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach(v => {
                console.log(v);
                vehiclesHTML += `
                    <tr>
                        <td>${v.vehicleNumber}</td>
                        <td>${v.model}</td>
                        <td>${v.vehicleType}</td>
                        <td>${v.fuelType}</td>
                        <td>${v.manufactureYear}</td>
                    </tr>
                `;
            });

            vehiclesHTML += `
                    </tbody>
                </table>
                </div>
            `;

            document.getElementById("contentArea").innerHTML = vehiclesHTML;
        });
}


    function loadVehicles() {

    document.getElementById("contentArea").innerHTML = `

        <h2 class="page-title">Vehicle Registry</h2>

        <div id="vehicleMessage"
             style="margin-bottom:15px; display:none; padding:10px 15px;
                    border-radius:6px; font-weight:500;">
        </div>

        <div class="card-container">

            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Vehicle No</th>
                        <th>Model</th>
                        <th>Type</th>
                        <th>Fuel</th>
                        <th>Year</th>
                        <th>Service Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="vehicleTable"></tbody>
            </table>
            <div id="vehiclesPagination" style="margin-top:20px;text-align:center;"></div>

        </div>
    `;

    fetchVehicles();
}
function fetchVehicles() {

    fetch(`${API_URL}/api/admin/vehicles`)
        .then(res => res.json())
        .then(data => {

            vehiclesData = data;
            currentVehiclePage = 1;
            renderVehiclesTable();
            renderPagination(vehiclesData, currentVehiclePage, "vehiclesPagination", "changeVehiclePage");

        })
        .catch(err => console.error("Vehicle fetch error:", err));
}


    function loadServices() {

    document.getElementById("contentArea").innerHTML = `

        <h2 class="page-title">Service History</h2>

        <!-- MESSAGE BOX (NEW) -->
        <div id="serviceMessage"
             style="display:none;
                    margin-bottom:15px;
                    padding:10px 15px;
                    border-radius:6px;
                    font-weight:500;">
        </div>

        <div class="card-container">

            <table>
                <thead>
                    <tr>
                        <th>Service ID</th>
                        <th>Vehicle</th>
                        <th>Service Type</th>
                        <th>Date Booked</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="serviceTable"></tbody>
            </table>

            <div id="servicesPagination"
                 style="margin-top:20px;text-align:center;">
            </div>

        </div>
    `;

    fetchServices();
}
function fetchServices() {

    fetch(`${API_URL}/api/admin/services`)
        .then(res => res.json())
        .then(data => {

            servicesData = data;
            currentServicePage = 1;
            renderServicesTable();
            renderPagination(servicesData, currentServicePage, "servicesPagination", "changeServicePage");
        })
        .catch(err => console.error("Service fetch error:", err));
}


function openAddUserModal() {
    document.getElementById("addUserModal").style.display = "flex";
}

function closeAddUserModal() {
    document.getElementById("addUserModal").style.display = "none";
}

function submitNewUser() {

    const name = document.getElementById("newName").value.trim();
    const username = document.getElementById("newUsername").value.trim();
    const email = document.getElementById("newEmail").value.trim();
    const phone = document.getElementById("newPhone").value.trim();
    const password = document.getElementById("newPassword").value.trim();


    if (!name || !username || !email || !phone || !password) {
        showAddUserMessage("All fields are required!", "error");
        return;
    }
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        showAddUserMessage("Please enter valid email!", "error");
        return;
    }

    const userData = { name, username, email, phone, password };

    fetch(`${API_URL}/api/admin/user?adminId=${adminId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(userData)
    })
    .then(res => {
        return res.text().then(text => ({
            status: res.status,
            message: text
        }));
    })
    .then(data => {

        if (data.status !== 200) {
            showAddUserMessage(data.message, "error");
        } else {
            showAddUserMessage(data.message, "success");


            document.getElementById("newName").value = "";
            document.getElementById("newUsername").value = "";
            document.getElementById("newEmail").value = "";
            document.getElementById("newPhone").value = "";
            document.getElementById("newPassword").value = "";

            if (localStorage.getItem("activePage") === "dashboard") {
                loadDashboard();
            }


            if (localStorage.getItem("activePage") === "users") {
                fetchUsers();
            }
        }
    })
    .catch(() => {
        showAddUserMessage("Server error", "error");
    });
}


function submitNewAdmin() {

    const name = document.getElementById("adminNameInput").value.trim();
    const username = document.getElementById("adminUsernameInput").value.trim();
    const email = document.getElementById("adminEmailInput").value.trim();
    const phone = document.getElementById("adminPhoneInput").value.trim();
    const password = document.getElementById("adminPasswordInput").value.trim();

    if (!name || !username || !email || !phone || !password) {
        showMessage("addAdminMessage", "All fields required", "error");
        return;
    }

    fetch(`${API_URL}/api/admin/admin?adminId=${adminId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, username, email, phone, password })
    })
    .then(res => res.text().then(text => ({
        status: res.status,
        message: text
    })))
    .then(data => {

        if (data.status !== 200) {
            showMessage("addAdminMessage",data.message, "error");
        } else {
            showMessage("addAdminMessage",data.message, "success");

            document.getElementById("adminNameInput").value = "";
            document.getElementById("adminUsernameInput").value = "";
            document.getElementById("adminEmailInput").value = "";
            document.getElementById("adminPhoneInput").value = "";
            document.getElementById("adminPasswordInput").value = "";
        }
    })
    .catch(() => {
        showMessage("addAdminMessage","Server error", "error");
    });
}


    function openAddAdminModal() {
    document.getElementById("addAdminModal").style.display = "flex";
}

function closeAddAdminModal() {
    document.getElementById("addAdminModal").style.display = "none";
}

    function navigate(page) {


    localStorage.setItem("activePage", page);

    document.querySelectorAll(".nav-item").forEach(item => {
        item.classList.remove("active");
    });

    const activeItem = document.querySelector(`[data-page="${page}"]`);
    if (activeItem) activeItem.classList.add("active");

    if (page === "dashboard") loadDashboard();
    else if (page === "users") loadUsers();
    else if (page === "vehicles") loadVehicles();
    else if (page === "services") loadServices();
    else if (page === "home") home();
    else if (page === "settings") loadSettings();
}

    function showAddUserMessage(message, type) {

    const box = document.getElementById("addUserMessage");

    box.innerText = message;
    box.style.display = "block";

    if (type === "success") {
        box.style.background = "rgba(34,197,94,0.1)";
        box.style.color = "#22c55e";
        box.style.border = "1px solid #22c55e";

        setTimeout(() => {
            closeAddUserModal();
        }, 1000);

    } else {
        box.style.background = "rgba(239,68,68,0.1)";
        box.style.color = "#ef4444";
        box.style.border = "1px solid #ef4444";
    }

    setTimeout(() => {
        box.style.display = "none";
    }, 4000);
}



    window.onload = function () {

    const savedPage = localStorage.getItem("activePage") || "dashboard";

    navigate(savedPage);
};

    function renderUsersTable() {

    const table = document.getElementById("usersTable");
    table.innerHTML = "";

    const start = (currentUserPage - 1) * pageSize;
    const end = start + pageSize;

    const paginatedUsers = usersData.slice(start, end);

    if (paginatedUsers.length === 0) {
        table.innerHTML = `
            <tr>
                <td colspan="5" style="text-align:center;color:#a1a1aa">
                    No Users Found
                </td>
            </tr>`;
        return;
    }

    paginatedUsers.forEach(user => {

        const statusColor = user.status === "Active" ? "#22c55e" : "#ef4444";

        table.innerHTML += `
            <tr>
                <td>U00${user.id}</td>
                <td>${user.name}</td>
                <td>${user.email}</td>
                <td style="color:${statusColor}; font-weight:600;">
                    ${user.status}
                </td>
                <td style="display:flex; gap:10px;">
                    <button onclick="viewUser(${user.id})"
                        style="background:#27272a;border:1px solid #2e2e2e;color:white;padding:6px 10px;border-radius:6px;cursor:pointer;">
                        <i class="fa-solid fa-eye"></i>
                    </button>
                    <button onclick="deleteUser(${user.id},${user.canDelete})"
                        style="background:#3f1d1d;border:1px solid #ef4444;color:#ef4444;padding:6px 10px;border-radius:6px;cursor:pointer;">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;
    });
}

    function changeUserPage(page) {
        currentUserPage = page;
        renderUsersTable();
        renderPagination(usersData, currentUserPage, "usersPagination", "changeUserPage");
}

function renderVehiclesTable() {

    const table = document.getElementById("vehicleTable");
    table.innerHTML = "";

    const start = (currentVehiclePage - 1) * pageSize;
    const end = start + pageSize;

    const paginatedVehicles = vehiclesData.slice(start, end);

    if (paginatedVehicles.length === 0) {
        table.innerHTML = `
            <tr>
                <td colspan="8" style="text-align:center;color:#a1a1aa">
                    No Vehicles Found
                </td>
            </tr>`;
        return;
    }

    paginatedVehicles.forEach(v => {

        let statusColor = "#fbbf24";

        if (v.serviceStatus === "ACTIVE")
            statusColor = "#3b82f6";
        else if (v.serviceStatus === "COMPLETED")
            statusColor = "#22c55e";

        table.innerHTML += `
            <tr>
                <td>V00${v.id}</td>
                <td>${v.vehicleNumber}</td>
                <td>${v.model}</td>
                <td>${v.vehicleType}</td>
                <td>${v.fuelType}</td>
                <td>${v.manufactureYear}</td>
                <td style="color:${statusColor}; font-weight:600;">
                    ${v.serviceStatus}
                </td>
                <td>
                    <button onclick="deleteVehicle(${v.id}, ${v.canDelete === true})"
                        style="background:#3f1d1d;border:1px solid #ef4444;color:#ef4444;padding:6px 10px;border-radius:6px;cursor:pointer;">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;
    });
}




    function renderServicesTable() {

    const table = document.getElementById("serviceTable");
    table.innerHTML = "";

    const start = (currentServicePage - 1) * pageSize;
    const end = start + pageSize;

    const paginated = servicesData.slice(start, end);

    if (paginated.length === 0) {
        table.innerHTML = `
            <tr>
                <td colspan="5" style="text-align:center;color:#a1a1aa">
                    No Services Found
                </td>
            </tr>`;
        return;
    }


    paginated.forEach(s => {

        let statusColor = "#fbbf24";

        if (s.status === "ACTIVE")
            statusColor = "#3b82f6";
        else if (s.status === "COMPLETED")
            statusColor = "#22c55e";

        table.innerHTML += `
        <tr>
            <td>S00${s.bookingId}</td>
            <td>${s.vehicleModel} (${s.vehicleNumber})</td>
            <td>${s.serviceType}</td>
            <td>${s.bookDate.replace("T"," ").substring(0,16)}</td>

            <td id="status-${s.bookingId}"
                style="color:${statusColor}; font-weight:600;">
                ${s.status}
            </td>

            <td>
                <button onclick="enableStatusEdit(${s.bookingId}, '${s.status}')"
                    style="background:#1e293b;
                           border:1px solid #3b82f6;
                           color:#3b82f6;
                           padding:6px 10px;
                           border-radius:6px;
                           cursor:pointer;">
                    <i class="fa-solid fa-pen"></i>
                </button>
            </td>
        </tr>
        `;
    });
}


    function showMessage(containerId, message, type) {
        const box = document.getElementById(containerId);

        box.innerText = message;
        box.style.display = "block";

        if (type === "success") {
            box.style.background = "rgba(34,197,94,0.1)";
            box.style.color = "#22c55e";
            box.style.border = "1px solid #22c55e";

            if (containerId === "addAdminMessage") {
                setTimeout(() => {
                    closeAddAdminModal();
                }, 1000);
            }

        } else {
            box.style.background = "rgba(239,68,68,0.1)";
            box.style.color = "#ef4444";
            box.style.border = "1px solid #ef4444";
        }

        setTimeout(() => {
            box.style.display = "none";
        }, 4000);
    }

function renderPagination(dataArray, currentPage, containerId, changeFunction) {

    const container = document.getElementById(containerId);
    container.innerHTML = "";

    const totalPages = Math.ceil(dataArray.length / pageSize);

    for (let i = 1; i <= totalPages; i++) {

        container.innerHTML += `
            <button onclick="${changeFunction}(${i})"
                style="
                    margin:5px;
                    padding:6px 12px;
                    border-radius:6px;
                    border:none;
                    cursor:pointer;
                    background:${i === currentPage ? '#f97316' : '#27272a'};
                    color:white;">
                ${i}
            </button>
        `;
    }
}

function deleteVehicle(id, canDelete) {

    if (!canDelete) {
        showMessage("vehicleMessage",
            "Cannot delete vehicle with active or pending services",
            "error"
        );
        return;
    }

    fetch(`${API_URL}/api/admin/vehicle/${id}?adminId=${adminId}`, {
        method: "DELETE"
    })
    .then(res => res.text())
    .then(message => {
        showMessage("vehicleMessage", message, "success");
        fetchVehicles();
    })
    .catch(() => {
        showMessage("vehicleMessage", "Error deleting vehicle", "error");
    });
}

function loadSettings() {

document.getElementById("contentArea").innerHTML = `

<h2 class="page-title">System Settings</h2>

<div class="card-container">

    <div style="display:flex; gap:25px; margin-bottom:25px;">
        <button class="action-btn" onclick="loadGeneral()">General</button>
        <button class="action-btn" onclick="loadNotifications()">Notifications</button>
        <button class="action-btn" onclick="loadAdminList()">Admin List</button>
        <button class="action-btn" onclick="loadSales()">Sales</button>
    </div>

    <div id="settingsContent"></div>

</div>
`;

loadGeneral();
}


function loadGeneral() {

document.getElementById("settingsContent").innerHTML = `

<h3 class="section-header">General Settings</h3>

<div style="display:flex; flex-direction:column; gap:15px; max-width:400px;">

<div id="profileMessage"
     style="display:none;
            margin-bottom:10px;
            padding:10px;
            border-radius:6px;
            font-weight:500;">
</div>


<h4 style="color: var(--text-muted);
            padding: 12px 12px 0.5px 0px;font-size: 14px;">Name</h3>
<input id="adminEditName" type="text" disabled
       style="padding:10px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;">

<h4 style="color: var(--text-muted);
            padding: 12px 12px 0.5px 0px;font-size: 14px;">Email</h3>
<input id="adminEditEmail" type="email" disabled
       style="padding:10px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;">

<div id="passwordSection" style="display:none;">
<h4 style="color: var(--text-muted);
            padding: 12px 12px 2px 0px;font-size: 14px;">Password</h3>
<input id="adminEditPassword" placeholder="Enter New Password"
       type="password"
       style="padding:10px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;width:100%;">
</div>

<div style="display:flex; gap:10px;">

<button id="editBtn"
        onclick="enableEdit()"
        style="background:#3f3f46;border:none;padding:10px;border-radius:6px;color:white;cursor:pointer;">
Edit Profile
</button>

<button onclick="updateAdminProfile()"
        id="saveProfileBtn"
        style="background:#f97316;border:none;padding:10px;border-radius:6px;color:white;cursor:pointer;display:none;">
Save Changes
</button>

</div>

</div>
`;

loadAdminProfile();
}


function loadNotifications() {

document.getElementById("settingsContent").innerHTML = `
<h3 class="section-header">Your Activity</h3>

<table>
<thead>
<tr>
<th>Date</th>
<th>Description</th>
</tr>
</thead>
<tbody id="activityTable"></tbody>
</table>

<div id="activityPagination" style="margin-top:20px;text-align:center;"></div>
`;

fetch(`${API_URL}/api/activities/user/${adminId}`)
.then(res => res.json())
.then(data => {

activityData = data;
currentActivityPage = 1;

renderActivityTable();
renderPagination(activityData, currentActivityPage,
                 "activityPagination", "changeActivityPage");

});
}


function loadAdminProfile() {

fetch(`${API_URL}/api/admin/profile/${adminId}`)
.then(res => {
    if (!res.ok) {
        throw new Error("Failed to load profile");
    }
    return res.json();
})
.then(data => {

    document.getElementById("adminEditName").value = data.name;
    document.getElementById("adminEditEmail").value = data.email;

})
.catch(err => {
    console.error("Profile load error:", err);
    alert("Failed to load profile");
});
}



function loadSales() {

document.getElementById("settingsContent").innerHTML = `

<h3 class="section-header">2nd Hand Car Sales</h3>

<div id="saleMessage"
     style="display:none;margin-bottom:15px;padding:10px;border-radius:6px;font-weight:500;">
</div>

<div class="sales-layout">

    <!-- ADD FORM -->
    <div class="sales-form">

        <label>Vehicle Type</label>
        <div class="toggle-group">

            <input type="radio" name="vehicleType" value="Car" id="car" checked>
            <label for="car" class="toggle-btn">Car</label>

            <input type="radio" name="vehicleType" value="Bike" id="bike">
            <label for="bike" class="toggle-btn">Bike</label>

        </div>

        <label>Brand</label>
        <input id="saleBrand" placeholder="Enter Brand">

        <label>Model</label>
        <input id="saleModel" placeholder="Enter Model">

        <label>Manufacture Year</label>
        <input id="saleYear" type="number" min="1990" max="2026" placeholder="e.g. 2020">

        <label>Fuel Type</label>
        <div class="toggle-group">

            <input type="radio" name="fuelType" value="Petrol" id="petrol" checked>
            <label for="petrol" class="toggle-btn">Petrol</label>

            <input type="radio" name="fuelType" value="Diesel" id="diesel">
            <label for="diesel" class="toggle-btn">Diesel</label>

            <input type="radio" name="fuelType" value="Electric" id="electric">
            <label for="electric" class="toggle-btn">Electric</label>

            <input type="radio" name="fuelType" value="CNG" id="cng">
            <label for="cng" class="toggle-btn">CNG</label>

        </div>

        <label>Owner Contact</label>
        <input id="salePhone" type="tel" placeholder="Enter Phone Number">

        <div style="display:flex; gap:10px; margin-top:10px;">

    <button id="saleSubmitBtn" onclick="submitSaleVehicle()"
        style="background:var(--primary);border:none;padding:10px;border-radius:6px;color:white;cursor:pointer;flex:1;">
        Add Vehicle
    </button>

    <button id="saleCancelBtn"
        onclick="cancelSaleEdit()"
        style="background:#3f3f46;border:none;padding:10px;border-radius:6px;color:white;cursor:pointer;display:none;">
        Cancel
    </button>

</div>

    </div>

    <!-- SALES LIST -->
    <div style="flex:2;">
        <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>Brand</th>
            <th>Model</th>
            <th>Year</th>
            <th>Fuel</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="salesTable"></tbody>
        </table>

        <div id="salesPagination" style="margin-top:20px;text-align:center;"></div>
    </div>

</div>
`;

fetchSalesVehicles();
}


function cancelSaleEdit() {

    resetSaleForm();

    showMessage("saleMessage", "Edit cancelled", "success");
}


function updateAdminProfile() {

const name = adminEditName.value.trim();
const email = adminEditEmail.value.trim();
const password = adminEditPassword.value.trim();

if (!name || !email) {
    showMessage("profileMessage", "Name and Email required", "error");
    return;
}

const bodyData = password
    ? { name, email, password }
    : { name, email };

fetch(`${API_URL}/api/admin/profile/${adminId}`, {
    method: "PUT",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(bodyData)
})
.then(res => res.text().then(text => ({
    status: res.status,
    message: text
})))
.then(data => {

    if (data.status !== 200) {
        showMessage("profileMessage", data.message, "error");
        return;
    }

    showMessage("profileMessage", data.message, "success");

    // Reset UI after success
    adminEditName.disabled = true;
    adminEditEmail.disabled = true;
    adminEditPassword.value = "";

    document.getElementById("passwordSection").style.display = "none";
    document.getElementById("saveProfileBtn").style.display = "none";

    const editBtn = document.getElementById("editBtn");
    editBtn.innerText = "Edit Profile";
    editBtn.style.background = "#3f3f46";

})
.catch(() => {
    showMessage("profileMessage", "Update failed", "error");
});
}



function enableEdit() {

const editBtn = document.getElementById("editBtn");
const saveBtn = document.getElementById("saveProfileBtn");
const passwordSection = document.getElementById("passwordSection");

if (editBtn.innerText === "Edit Profile") {

    adminEditName.disabled = false;
    adminEditEmail.disabled = false;

    passwordSection.style.display = "block";
    saveBtn.style.display = "block";

    editBtn.innerText = "Cancel";
    editBtn.style.background = "#ef4444";

} else {

    // Cancel mode
    adminEditName.disabled = true;
    adminEditEmail.disabled = true;
    adminEditPassword.value = "";

    passwordSection.style.display = "none";
    saveBtn.style.display = "none";

    editBtn.innerText = "Edit Profile";
    editBtn.style.background = "#3f3f46";

    loadAdminProfile(); // restore original values
}
}

function renderActivityTable() {

const table = document.getElementById("activityTable");
table.innerHTML = "";

const start = (currentActivityPage - 1) * pageSize;
const end = start + pageSize;

const paginated = activityData.slice(start, end);

if (paginated.length === 0) {
    table.innerHTML = `
        <tr>
            <td colspan="2" style="text-align:center;color:#a1a1aa">
                No Activity Found
            </td>
        </tr>`;
    return;
}

paginated.forEach(a => {
    table.innerHTML += `
        <tr>
            <td>${a.date.replace("T"," ").substring(0,16)}</td>
            <td>${a.description}</td>
        </tr>
    `;
});
}

function loadAdminList() {

        document.getElementById("settingsContent").innerHTML = `
        <h3 class="section-header">Admin List</h3>

        <div style="display:flex; gap:15px; margin-bottom:20px; align-items:center;">

            <select id="adminSearchType"
                    style="background:#27272a;border:1px solid #2e2e2e;color:white;padding:8px;border-radius:6px;">
                <option value="name" selected>Name</option>
                <option value="email">Email</option>
            </select>

            <input type="text"
                   id="adminSearchInput"
                   placeholder="Search..."
                   onkeyup="applyAdminSearch()"
                   style="flex:1;padding:8px;background:#27272a;border:1px solid #2e2e2e;color:white;border-radius:6px;">

        </div>

        <div id="adminMessage"
             style="margin-bottom:15px; display:none; padding:10px 15px;
                    border-radius:6px; font-weight:500;">
        </div>

        <table>
        <thead>
        <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Actions</th>
        </tr>
        </thead>
        <tbody id="adminTable"></tbody>
        </table>

        <div id="adminPagination" style="margin-top:20px;text-align:center;"></div>
        `;

        fetch(`${API_URL}/api/admin/admins`)
        .then(res => res.json())
        .then(data => {

        adminData = data;
        currentAdminPage = 1;

        renderAdminTable();
        renderPagination(adminData, currentAdminPage,
                         "adminPagination", "changeAdminPage");

        });
    }

function renderAdminTable() {

const table = document.getElementById("adminTable");
table.innerHTML = "";

const start = (currentAdminPage - 1) * pageSize;
const end = start + pageSize;

const paginated = adminData.slice(start, end);

if (paginated.length === 0) {
    table.innerHTML = `
        <tr>
            <td colspan="4" style="text-align:center;color:#a1a1aa">
                No Admins Found
            </td>
        </tr>`;
    return;
}

paginated.forEach(admin => {
table.innerHTML += `
<tr>
<td>A00${admin.id}</td>
<td>${admin.name}</td>
<td>${admin.email}</td>
<td>
<button onclick="deleteAdmin(${admin.id})"
style="background:#3f1d1d;border:1px solid #ef4444;color:#ef4444;padding:6px 10px;border-radius:6px;">
<i class="fa-solid fa-trash"></i>
</button>
</td>
</tr>
`;
});
}


function applyAdminSearch() {

    const type = document.getElementById("adminSearchType").value;
    const searchValue = document.getElementById("adminSearchInput")
                        .value.toLowerCase();

    let filtered = adminData.filter(admin => {

        if (type === "name") {
            return admin.name.toLowerCase().includes(searchValue);
        } else {
            return admin.email.toLowerCase().includes(searchValue);
        }

    });

    currentAdminPage = 1;
    renderAdminTableFiltered(filtered);
    renderPagination(filtered, currentAdminPage,
                     "adminPagination", "changeAdminPageFiltered");
}


function renderAdminTableFiltered(filteredData) {

const table = document.getElementById("adminTable");
table.innerHTML = "";

const start = (currentAdminPage - 1) * pageSize;
const end = start + pageSize;

const paginated = filteredData.slice(start, end);

if (paginated.length === 0) {
    table.innerHTML = `
        <tr>
            <td colspan="4" style="text-align:center;color:#a1a1aa">
                No Admins Found
            </td>
        </tr>`;
    return;
}

paginated.forEach(admin => {
table.innerHTML += `
<tr>
<td>A00${admin.id}</td>
<td>${admin.name}</td>
<td>${admin.email}</td>
<td>
<button onclick="deleteAdmin(${admin.id})"
style="background:#3f1d1d;border:1px solid #ef4444;color:#ef4444;padding:6px 10px;border-radius:6px;">
<i class="fa-solid fa-trash"></i>
</button>
</td>
</tr>
`;
});
}

function changeAdminPageFiltered(page) {
    currentAdminPage = page;
    applyAdminSearch();
}

function deleteAdmin(id) {

    const messageBox = document.getElementById("adminMessage");

    fetch(`${API_URL}/api/admin/admin/${id}?adminId=${adminId}`, {
        method: "DELETE"
    })
    .then(res => res.text().then(text => ({
        status: res.status,
        message: text || "Operation completed"
    })))
    .then(data => {

        if (!messageBox) return;

        if (data.status !== 200) {
            showMessage("adminMessage", data.message, "error");
        } else {
            showMessage("adminMessage", data.message, "success");

            setTimeout(() => {
                loadAdminList();
            }, 1000);
        }
    })
    .catch(() => {
        showMessage("adminMessage", "Error deleting admin", "error");
    });
}


let salesData = [];
let currentSalesPage = 1;

function fetchSalesVehicles() {

fetch(`${API_URL}/api/admin/sales`)
.then(res => res.json())
.then(data => {

    salesData = data;
    currentSalesPage = 1;

    renderSalesTable();
    renderPagination(salesData, currentSalesPage,
                     "salesPagination", "changeSalesPage");
});
}

function renderSalesTable() {

const table = document.getElementById("salesTable");
table.innerHTML = "";

const start = (currentSalesPage - 1) * pageSize;
const end = start + pageSize;

const paginated = salesData.slice(start, end);

if (paginated.length === 0) {
    table.innerHTML = `
        <tr>
            <td colspan="6" style="text-align:center;color:#a1a1aa">
                No Sales Vehicles Found
            </td>
        </tr>`;
    return;
}

paginated.forEach(v => {
table.innerHTML += `
<tr>
<td>S00${v.id}</td>
<td>${v.brand}</td>
<td>${v.model}</td>
<td>${v.manufactureYear}</td>
<td>${v.fuelType}</td>
<td style="display:flex; gap:8px;">

    <button onclick="editSaleVehicle(${v.id})"
        style="background:#1e293b;border:1px solid #3b82f6;color:#3b82f6;padding:6px 10px;border-radius:6px;cursor:pointer;">
        <i class="fa-solid fa-pen"></i>
    </button>

    <button onclick="deleteSaleVehicle(${v.id})"
        style="background:#3f1d1d;border:1px solid #ef4444;color:#ef4444;padding:6px 10px;border-radius:6px;cursor:pointer;">
        <i class="fa-solid fa-trash"></i>
    </button>

</td>
</tr>
`;
});
}


function enableStatusEdit(id, currentStatus) {

    const cell = document.getElementById(`status-${id}`);

    cell.innerHTML = `
        <select id="statusSelect-${id}"
            onchange="updateServiceStatus(${id})"
            style="background:#27272a;
                   border:1px solid #2e2e2e;
                   color:white;
                   padding:6px;
                   border-radius:6px;">
            <option value="PENDING" ${currentStatus === "PENDING" ? "selected" : ""}>PENDING</option>
            <option value="ACTIVE" ${currentStatus === "ACTIVE" ? "selected" : ""}>ACTIVE</option>
            <option value="COMPLETED" ${currentStatus === "COMPLETED" ? "selected" : ""}>COMPLETED</option>
        </select>
    `;
}


function updateServiceStatus(id) {

    const newStatus =
        document.getElementById(`statusSelect-${id}`).value;

    fetch(`${API_URL}/api/admin/service/${id}/status?adminId=${adminId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ status: newStatus })
    })
    .then(res => res.text().then(text => ({
        status: res.status,
        message: text
    })))
    .then(data => {

        if (data.status !== 200) {
            showMessage("serviceMessage", data.message, "error");
        } else {
            showMessage("serviceMessage",
                        "Service status updated successfully",
                        "success");

            fetchServices(); // reload table
        }
    })
    .catch(() => {
        showMessage("serviceMessage",
                    "Status update failed",
                    "error");
    });
}




function changeSalesPage(page) {
currentSalesPage = page;
renderSalesTable();
renderPagination(salesData, currentSalesPage,
                 "salesPagination", "changeSalesPage");
}



function submitSaleVehicle() {

const vehicleType = document.querySelector('input[name="vehicleType"]:checked').value;
const fuelType = document.querySelector('input[name="fuelType"]:checked').value;

const data = {
    vehicleType,
    model: saleModel.value.trim(),
    manufactureYear: saleYear.value.trim(),
    brand: saleBrand.value.trim(),
    fuelType,
    phone: salePhone.value.trim()
};

if (Object.values(data).some(v => !v)) {
    showMessage("saleMessage", "All fields required", "error");
    return;
}


if (editingSaleId !== null) {

    fetch(`${API_URL}/api/admin/sales/${editingSaleId}?adminId=${adminId}`, {
        method: "PUT",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
    })
    .then(res => res.text())
    .then(message => {

        showMessage("saleMessage", message, "success");

        resetSaleForm();
        fetchSalesVehicles();
    });

}

else {

    fetch(`${API_URL}/api/admin/sales?adminId=${adminId}`, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
    })
    .then(res => res.text())
    .then(message => {

        showMessage("saleMessage", message, "success");

        resetSaleForm();
        fetchSalesVehicles();
    });
}
}


function resetSaleForm() {

    saleBrand.value = "";
    saleModel.value = "";
    saleYear.value = "";
    salePhone.value = "";

    document.querySelector('input[name="vehicleType"][value="Car"]').checked = true;
    document.querySelector('input[name="fuelType"][value="Petrol"]').checked = true;

    editingSaleId = null;

    document.getElementById("saleSubmitBtn").innerText = "Add Vehicle";
    document.getElementById("saleCancelBtn").style.display = "none";
}




function deleteSaleVehicle(id) {

fetch(`${API_URL}/api/admin/sales/${id}?adminId=${adminId}`, {
    method: "DELETE"
})
.then(res => res.text().then(text => ({
    status: res.status,
    message: text
})))
.then(data => {

    if (data.status !== 200) {
        showMessage("saleMessage", data.message, "error");
    } else {
        showMessage("saleMessage", data.message, "success");
        fetchSalesVehicles();
    }
})
.catch(() => {
    showMessage("saleMessage", "Delete failed", "error");
});
}

function editSaleVehicle(id) {

    const vehicle = salesData.find(v => v.id === id);
    if (!vehicle) return;

    editingSaleId = id;

    // Fill form fields
    saleBrand.value = vehicle.brand;
    saleModel.value = vehicle.model;
    saleYear.value = vehicle.manufactureYear;
    salePhone.value = vehicle.phone;

    // Select radio buttons
    document.querySelector(`input[name="vehicleType"][value="${vehicle.vehicleType}"]`).checked = true;
    document.querySelector(`input[name="fuelType"][value="${vehicle.fuelType}"]`).checked = true;

    // Change button text
    document.getElementById("saleSubmitBtn").innerText = "Update Vehicle";
    document.getElementById("saleCancelBtn").style.display = "block";

    // Scroll to form
    window.scrollTo({ top: 0, behavior: "smooth" });
}




function changeAdminPage(page) {
    currentAdminPage = page;
    renderAdminTable();
    renderPagination(adminData, currentAdminPage,
                     "adminPagination", "changeAdminPage");
}



function changeActivityPage(page) {
    currentActivityPage = page;
    renderActivityTable();
    renderPagination(activityData, currentActivityPage,
                     "activityPagination", "changeActivityPage");
}

function changeServicePage(page) {
    currentServicePage = page;
    renderServicesTable();
    renderPagination(servicesData, currentServicePage, "servicesPagination", "changeServicePage");
}


function changeVehiclePage(page) {
    currentVehiclePage = page;
    renderVehiclesTable();
    renderPagination(vehiclesData, currentVehiclePage, "vehiclesPagination", "changeVehiclePage");
}

    function logout() {
        localStorage.clear();
        window.location.href = "login.html";
    }
    function home(){
    localStorage.removeItem("activePage");
    window.location.href = "home.html";
    }

</script>
</body>
</html>


