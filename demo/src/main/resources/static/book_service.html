<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book Service | GMS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
          margin: 0;
          font-family: "Inter", "Segoe UI", sans-serif;
          background: radial-gradient(circle at top, #151515, #0f0f0f);
          color: #e0e0e0;
        }

        .container {
          max-width: 1100px;
          margin: 40px auto;
          padding: 20px;
        }

        h1 {
          font-size: 28px;
          margin-bottom: 6px;
        }

        .subtitle {
          color: #9e9e9e;
          margin-bottom: 30px;
        }

        /* ===== VEHICLE SELECT ===== */
        .vehicle-select {
          margin-bottom: 30px;
        }

        select {
          width: 300px;
          padding: 10px;
          background: #1c1c1c;
          border: 1px solid #333;
          color: #fff;
          border-radius: 8px;
        }

        /* ===== SERVICE CARDS ===== */
        .service-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
          gap: 24px;
        }

        .service-card {
          background: #1c1c1c;
          border: 1px solid #2a2a2a;
          border-radius: 16px;
          padding: 24px;
          transition: all 0.3s ease;
          cursor: pointer;
        }

        .service-card:hover {
          transform: translateY(-6px);
          border-color: #ff9800;
        }

        .service-card.selected {
          border: 2px solid #ff9800;
          background: linear-gradient(180deg, #1f1f1f, #141414);
        }

        .service-title {
          font-size: 18px;
          margin-bottom: 10px;
        }

        .price {
          font-size: 26px;
          color: #ff9800;
          margin-bottom: 14px;
        }

        ul {
          padding-left: 18px;
          margin-bottom: 20px;
          color: #bdbdbd;
          font-size: 14px;
        }

        li {
          margin-bottom: 6px;
        }

        .select-btn {
          width: 100%;
          padding: 10px;
          border-radius: 10px;
          border: none;
          font-weight: 600;
          cursor: pointer;
          background: #2a2a2a;
          color: #fff;
        }

        .service-card.selected .select-btn {
          background: #ff9800;
          color: #111;
        }

        /* ===== MESSAGE ===== */
        .message {
          margin: 30px 0px 30px 0px;
          padding: 14px;
          border-radius: 10px;
          display: none;
          font-weight: 500;
        }

        .message.success {
          background: rgba(52, 211, 153, 0.15);
          border: 1px solid rgba(52, 211, 153, 0.4);
          color: #34d399;
        }

        .message.error {
          background: rgba(255, 92, 92, 0.15);
          border: 1px solid rgba(255, 92, 92, 0.4);
          color: #ff5c5c;
        }

        #bookServiceBtn {
          margin-top: 30px;
          padding: 14px 28px;
          background: #ff9800;
          color: #111;
          border: none;
          border-radius: 12px;
          font-size: 16px;
          font-weight: 700;
          cursor: pointer;
        }

        #bookServiceBtn:hover{
            transform: translateY(-6px);
        }

        /* ===== TOP BAR ===== */
        /*.top-bar {
          display: flex;
          justify-content: flex-end;
          padding: 16px 40px;
        }*/

        .dashboard-btn {
          background: transparent;
          border: 1px solid #ff9800;
          color: #ff9800;
          padding: 8px 18px;
          border-radius: 8px;
          font-weight: 600;
          cursor: pointer;
        }

        .dashboard-btn:hover {
          background: #ff9800;
          color: #111;
        }

        /* ===== HERO SECTION ===== */
        .hero {
          position: relative;
          width: 100%;
          height: 360px;
          overflow: hidden;
          border-radius: 18px;
          margin-bottom: 40px;
        }

        .hero img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .dashboard-btn {
          position: absolute;
          top: 20px;
          right: 20px;
          z-index: 3;

          background: rgba(0,0,0,0.6);
          border: 1px solid #ff9800;
          color: #ff9800;
          padding: 8px 18px;
          border-radius: 8px;
          font-weight: 600;
          cursor: pointer;
        }

        .dashboard-btn:hover {
          background: #ff9800;
          color: #111;
        }

        .hero-overlay {
          position: absolute;
          inset: 0;
          background: linear-gradient(
            rgba(0,0,0,0.6),
            rgba(0,0,0,0.85)
          );
          display: flex;
          flex-direction: column;
          justify-content: center;
          padding-left: 60px;
        }

        .hero-overlay h1 {
          font-size: 36px;
          margin-bottom: 10px;
        }

        .hero-overlay p {
          color: #bdbdbd;
          font-size: 16px;
        }

    </style>
</head>

<body>

<div class="hero">
    <img src="img.png" alt="Car Service">

    <button class="dashboard-btn" onclick="goToDashboard()">Dashboard</button>

    <div class="hero-overlay">
        <h1>Book a New Service</h1>
        <p>Choose a maintenance package for your vehicle</p>
    </div>
</div>



<div class="container">
<!--    <h1>Book a New Service</h1>-->
<!--    <p class="subtitle">Choose a maintenance package for your vehicle</p>-->

    <!-- MESSAGE -->
    <div id="messageBox" class="message"></div>
    <!-- VEHICLE DROPDOWN -->
    <div class="vehicle-select">
        <label>Select Vehicle</label><br><br>
        <select id="vehicleSelect">
            <option value="">-- Select Vehicle --</option>
            <option value="1">Honda City (MH12 AB 1234)</option>
            <option value="2">Hyundai i20 (MH14 XY 5678)</option>
        </select>
    </div>

    <!-- SERVICE CARDS -->
    <div class="service-grid">

        <div class="service-card"
             data-service="BASIC"
             data-price="1999">
            <div class="service-title">Basic Service</div>
            <div class="price">â‚¹1,999</div>
            <ul>
                <li>Oil & Filter Change</li>
                <li>Fluid Top-up</li>
                <li>Tyre Pressure Check</li>
                <li>General Inspection</li>
            </ul>
            <button class="select-btn">Select Plan</button>
        </div>

        <div class="service-card"
             data-service="STANDARD"
             data-price="3999">
            <div class="service-title">Standard Service</div>
            <div class="price">â‚¹3,999</div>
            <ul>
                <li>Everything in Basic</li>
                <li>Brake Inspection</li>
                <li>Battery Test</li>
                <li>Cabin Filter Replacement</li>
            </ul>
            <button class="select-btn">Select Plan</button>
        </div>

        <div class="service-card"
             data-service="PREMIUM"
             data-price="6999">
            <div class="service-title">Premium Service</div>
            <div class="price">â‚¹6,999</div>
            <ul>
                <li>Everything in Standard</li>
                <li>Engine Diagnostics</li>
                <li>A/C System Check</li>
                <li>Exterior Wash & Wax</li>
            </ul>
            <button class="select-btn">Select Plan</button>
        </div>

        <div class="service-card"
             data-service="OIL_CHANGE"
             data-price="799">
            <div class="service-title">Oil Change</div>
            <div class="price">â‚¹799</div>
            <ul>
                <li>Engine oil replacement</li>
                <li>Oil filter check</li>
                <li>Fluid inspection</li>
            </ul>
            <button class="select-btn">Select Service</button>
        </div>

        <div class="service-card" data-service="BRAKE_SERVICE" data-price="1499">
            <div class="service-title">Brake Service</div>
            <div class="price">â‚¹1,499</div>
            <ul>
                <li>Brake pad inspection</li>
                <li>Disc & fluid check</li>
                <li>Safety testing</li>
            </ul>
            <button class="select-btn">Select Service</button>
        </div>

        <div class="service-card" data-service="WHEEL_ALIGNMENT" data-price="999">
            <div class="service-title">Wheel Alignment</div>
            <div class="price">â‚¹999</div>
            <ul>
                <li>Alignment correction</li>
                <li>Steering balance</li>
                <li>Tyre wear reduction</li>
            </ul>
            <button class="select-btn">Select Service</button>
        </div>

        <div class="service-card" data-service="BATTERY_REPLACEMENT" data-price="3999">
            <div class="service-title">Battery Replacement</div>
            <div class="price">â‚¹3,999</div>
            <ul>
                <li>Battery health check</li>
                <li>New battery install</li>
                <li>Electrical testing</li>
            </ul>
            <button class="select-btn">Select Service</button>
        </div>


        <div class="service-card" data-service="AC_SERVICE" data-price="1299">
            <div class="service-title">AC Service</div>
            <div class="price">â‚¹1,299</div>
            <ul>
                <li>Gas refill</li>
                <li>Cooling performance test</li>
                <li>Leak inspection</li>
            </ul>
            <button class="select-btn">Select Service</button>
        </div>


        <div class="service-card" data-service="CAR_WASH" data-price="499">
            <div class="service-title">Car Wash</div>
            <div class="price">â‚¹499</div>
            <ul>
                <li>Exterior wash</li>
                <li>Interior vacuum</li>
                <li>Dashboard cleaning</li>
            </ul>
            <button class="select-btn">Select Service</button>
        </div>




    </div>
    <button id="bookServiceBtn">Book Service</button>


</div>

<script>
    const API_URL = "http://localhost:8081";
    const userId = localStorage.getItem("userId");

    if (!userId) {
      window.location.href = "login.html";
    }


    let selectedServiceType = null;
    let selectedPrice = null;
    let selectedVehicleId = null;

    const cards = document.querySelectorAll(".service-card");
    const vehicleSelect = document.getElementById("vehicleSelect");
    const messageBox = document.getElementById("messageBox");

    vehicleSelect.addEventListener("change", () => {
      selectedVehicleId = vehicleSelect.value;
    });



    cards.forEach(card => {
      card.addEventListener("click", () => {

        cards.forEach(c => c.classList.remove("selected"));
        card.classList.add("selected");

        selectedServiceType = card.dataset.service;
        selectedPrice = card.dataset.price;

        showMessage(
          `Selected ${selectedServiceType} service for â‚¹${selectedPrice}`,
          "success"
        );

        // ðŸ”¥ READY FOR BACKEND USE
        console.log({
          vehicleId: selectedVehicleId,
          serviceType: selectedServiceType,
          price: selectedPrice
        });
      });
    });


    async function loadUserVehicles() {
      try {
        const res = await fetch(`${API_URL}/vehicles/user/${userId}`);
        const vehicles = await res.json();

        const select = document.getElementById("vehicleSelect");
        select.innerHTML = `<option value="">-- Select Vehicle --</option>`;

        vehicles.forEach(v => {
          const option = document.createElement("option");
          option.value = v.vehicleId;
          option.textContent = `${v.brand} ${v.model} (${v.vehicleNumber})`;
          select.appendChild(option);
        });

      } catch (err) {
        console.error("Failed to load vehicles");
      }
    }

    //vehicleSelect.addEventListener("change", () => {
      //console.log("Vehicle selected:", vehicleSelect.value);
    //});

    console.log("Booking vehicle:", vehicleSelect.value);

    document.getElementById("bookServiceBtn").addEventListener("click", async () => {

      //const selectedVehicleId = document.getElementById("vehicleSelect").value;


      if (!selectedVehicleId) {
        showMessage("Please select a vehicle", "error");
        return;
      }

      if (!selectedServiceType) {
        showMessage("Please select a service plan", "error");
        return;
      }

      const bookingData = {
          userId: Number(userId),
          vehicleId: Number(selectedVehicleId),
          serviceType: selectedServiceType,
          price: Number(selectedPrice)
        };
        //console.log("FINAL PAYLOAD: ",bookingData);



        const bookBtn = document.getElementById("bookServiceBtn");
        bookBtn.disabled = true;
        bookBtn.innerText = "Booking...";


        try {
            const res = await fetch(`${API_URL}/service-bookings`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(bookingData)
            });

            const message = await res.text();
            if (!res.ok) {
              showMessage("Something went wrong. Please try again.","error");
              return;
            }


            if (message.toLowerCase().includes("already booked")) {
                showMessage(
                    "This service is already in progress for the selected vehicle.",
                    "error"
                );
                return;
            }

            //Success
            showMessage(
                "Service booked successfully! Our team will contact you shortly.",
                "success"
            );
            console.log("FINAL PAYLOAD: ",bookingData);

      } catch (err) {
        showMessage("Failed to book service", "error");
      } finally {
        bookBtn.disabled = false;
        bookBtn.innerText = "Book Service";
      }
    });




    window.addEventListener("DOMContentLoaded", loadUserVehicles);

    function showMessage(text, type) {
      messageBox.innerText = text;
      messageBox.className = `message ${type}`;
      messageBox.style.display = "block";
    }

    function goToDashboard() {
      window.location.href = "user_dashboard.html";
    }

</script>

</body>
</html>
